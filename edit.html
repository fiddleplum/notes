<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="markdown.js"></script>
		<script>
			function getQueryParam(name) {
				name = name.replace(/[\[\]]/g, "\\$&");
				var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(window.location.href);
				if (!results) {
					return null;
				}
				if (!results[2]) {
					return '';
				}
				return decodeURIComponent(results[2].replace(/\+/g, " "));
			}

			function getNote(name) {
				$.ajax({
					url: "notes/" + name + ".txt",
					context: document.body,
					success: function(data) {
						$("#markdown textarea").html(data);
						updateHtml();
					},
					error: function() {
						showMessage("Could not load note \"" + name + "\".");
					}
				});
			}

			function updateHtml() {
				$("#html").html(textToHtml($("#markdown textarea")[0].value));
			}

			function showMessage(message) {
				var div = $("#message");
				div.html(message);
				div.fadeIn(250);
			}

			function start () {
				var name = getQueryParam("n");
				if(name === null) {
					showMessage("No n query param found.");
					return;
				}
				getNote(name);
			}

			window.addEventListener("load", start, false);
		</script>
		<link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Oxygen+Mono" rel="stylesheet">
		<link href="edit.css" rel="stylesheet">
	</head>
	<body>
		<div id="markdown">
			<form>
				<textarea placeholder="Enter markdown here." oninput="updateHtml()";></textarea>
			</form>
		</div>
		<div id="html"></div>
		<div id="clear"></div>
		<div id="message"></div>
	</body>
</html>